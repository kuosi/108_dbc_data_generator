#!/bin/sh -e

### https://snapcraft.io/docs/supported-snap-hooks
### The configure hook is called every time one the following actions happen:
###     initial snap installation
###     snap refresh
###     whenever the user runs snap set|unset to change a configuration option

### call the snapctl cmd for setting the configuration fields values

get_conf(){
    # $1: snap configuration parameter
    # $2: default value of the snap configuration parameter
    
    conf_param="$(snapctl get $1)"

    if [ -z "$conf_param" ]; then
        snapctl set $1=$2
    fi
}

get_conf "can.interface" "vcan0"

get_conf "can.frequency" "2"

get_conf "can.fd" "False"

get_conf "dbc.file" "${SNAP_DATA}/options/j1939_orig.dbc"

get_conf "dbc.messages" "${SNAP_DATA}/options/selected_messages"

snapctl get can dbc > $SNAP_DATA/options/configuration.json
snapctl restart dbc-data-generator-108
